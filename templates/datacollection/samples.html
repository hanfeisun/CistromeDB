{% extends "datacollection/login_base.html" %}
{% load dc_extras %}

{% block title %}Cistrome Paper Collection - Samples{% endblock %}
{% block include %}
<link href="{% url static_url %}css/samples.css" rel="stylesheet" type="text/css"/>
<script src="{% url static_url %}js/prototype.js" type="text/javascript"></script>
<script src="{% url static_url %}js/settings.js" type="text/javascript"></script>
<script src="{% url static_url %}js/samples.js" type="text/javascript"></script>
<script src="{% url static_url %}js/manage_files.js" type="text/javascript"></script>
{% endblock %}

{% block onload %}
onload="init();"
{% endblock %}

{% block content %}
      {% if user.is_authenticated %}
      <input type="button" id="batchEdit" value="batch edit"/>
      {% ifequal user.get_profile.team "admin" %}
      <input type="button" id="deleteBtn" value="delete"/>
      {% endifequal %}
      {% endif %}
      {% if pg.paginator.num_pages %}
      <div class="pagination">
          <span class="step-links">
              {% if pg.has_previous %}
	      {% ifnotequal pg.previous_page_number 1 %}
	      <a href="?page=1{{rest}}">first</a>
	      {% endifnotequal %}
              <a href="?page={{ pg.previous_page_number }}{{rest}}">previous</a>
              {% endif %}

              <span class="current">Page {{ pg.number }} of {{ pg.paginator.num_pages }}.</span>

              {% if pg.has_next %}
              <a href="?page={{ pg.next_page_number }}{{rest}}">next</a>
	      {% ifnotequal pg.next_page_number pg.paginator.num_pages %}
	      <a href="?page={{pg.paginator.num_pages}}{{rest}}">last</a>
	      {% endifnotequal %}
              {% endif %}
          </span>
      </div>
      {% endif %}
      <table>
         <tr>{% if user.is_authenticated %}
	     <th><input type="checkbox" id="masterCheckbox"/></th>
	     {% endif %}
	     <th>ID</th>
	     <th>GSMID</th>
	     <th>Paper</th>
	     <th>Files</th>
	     <th>Status</th>
	     <th>Comments</th>
	     <th>User</th>
	     <th>Uploader</th>
	     <th>Curator</th>
	     <th>Date Collected</th>
	     {% if user.is_authenticated %}
	     <th>Action</th>
	     {% endif %}
	 </tr>
	 {% for s in pg.object_list %}
	 <tr>
	     {% if user.is_authenticated %}
	     <td><input type="checkbox" class="rowSelect" id="{{s.id}}"/>
	         <a href="{% url update_sample_form s.id %}?next={{request.get_full_path|urlencode}}">edit</a><br/>
	         <!-- REPLACED by manage files
		    <a href="{% url upload_sample_form s.id %}?next={{request.get_full_path|urlencode}}">upload</a>-->
	     </td>
	     {% endif %}
	     <td><a href="{% url sample_profile s.id %}">{{s.id}}</a></td>
	     <td><a href="http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc={{s.gsmid}}" target="_blank">{{s.gsmid}}</a></td>
	     <td>
	      <a href="http://www.ncbi.nlm.nih.gov/pubmed?term={{s.paper.pmid}}" target="_blank">{{s.paper.pmid}}</a></br></br>
	      <a href="{% url paper_profile s.paper.id %}">paper profile</a>
	     </td>
	     <td>
	       {% for f in s.getFileFields%}
	       {% if f %}
	       <span><a href="{{f.url|sub_site}}">{{f.field.name}}</a></span></br>
	       {% endif %}
	       {% endfor %}
	     </td>
	     {% ifequal s.status "imported" %}
	     <td class="imported_row">{{ s.get_status_display }}</td>
	     {% else %} {% ifequal s.status "info" %}
	     <td class="info_row">{{ s.get_status_display }}</td>
	     {% else %} {% ifequal s.status "valid" %}
	     <td class="valid_row">{{ s.get_status_display }}</td>
	     {% else %} {% ifequal s.status "transfer" %}
	     <td class="transfer_row">{{ s.get_status_display }}</td>
	     {% else %} {% ifequal s.status "downloaded" %}
	     <td class="downloaded_row">{{ s.get_status_display }}</td>
	     {% else %} {% ifequal s.status "error" %}
	     <td class="error_row">{{ s.get_status_display }}</td>
	     {% else %}
	     <td>{{ s.get_status_display }}</td>
	     {% endifequal %}{% endifequal %}{% endifequal %}{% endifequal %}{% endifequal %}{% endifequal %}
	     <td>{{ s.comments }}</td>
	     <td><a href="{% url samples %}{{s.user.id}}/">{{ s.user.username }}</a></td>
	     <td>{{s.uploader.username}}</td>
	     <td>{{s.curator.username}}</td>
	     <td>{{ s.date_collected|date:"Y-m-d"}}</td>
	     {% comment %} ACTIONS HERE {% endcomment %}
	     {% if user.is_authenticated %}
	     <td>
	     {% ifequal s.status "info" %}
	     <input type="button" value="validate" onclick=""/>
	     {% else %}{% ifequal s.status "valid" %}
	     <input type="button" value="download raw file" onclick="downloadFile({{s.id}}, {{pg.number}});"/>
	     {% else %} {% ifequal s.status "transfer" %}
	     <input type="button" value="download raw file" disabled="true"/>
	     {% else %} 
	     <!-- no action -->
	     {% endifequal %}{% endifequal %}{% endifequal %}
	     <input type="button" value="manage files" onclick="manageFiles('Samples', {{s.id}});"/>
	     </td>
	     {% endif %} 
	 </tr>
	 {% endfor %}
      </table>
<!-- from http://docs.djangoproject.com/en/1.1/topics/pagination/-->
      {% if pg.paginator.num_pages %}
      <div class="pagination">
          <span class="step-links">
              {% if pg.has_previous %}
	      {% ifnotequal pg.previous_page_number 1 %}
	      <a href="?page=1{{rest}}">first</a>
	      {% endifnotequal %}
              <a href="?page={{ pg.previous_page_number }}{{rest}}">previous</a>
              {% endif %}

              <span class="current">Page {{ pg.number }} of {{ pg.paginator.num_pages }}.</span>

              {% if pg.has_next %}
              <a href="?page={{ pg.next_page_number }}{{rest}}">next</a>
	      {% ifnotequal pg.next_page_number pg.paginator.num_pages %}
	      <a href="?page={{pg.paginator.num_pages}}{{rest}}">last</a>
	      {% endifnotequal %}
              {% endif %}
          </span>
      </div>
      {% endif %}
{% endblock %}

