{% extends "datacollection/base.html" %}
{% block title %}Cistrome Paper Collection - Datasets{% endblock %}
{% block include %}
<link href="{% url static_url %}css/datasets.css" rel="stylesheet" type="text/css"/>
<script src="{% url static_url %}js/prototype.js" type="text/javascript"></script>
<script src="{% url static_url %}js/settings.js" type="text/javascript"></script>
<script src="{% url static_url %}js/datasets.js" type="text/javascript"></script>
{% endblock %}

{% block login_form %}
      {% if user.is_authenticated %}
      <span id="login">Welcome, {{ user.username }}. <a href="{% url logout %}">logout</a></span>
      {% else %}
      <form action="{% url login %}" method="post" id="login">
         <label for="username">Administrator Login:</label>
	 <input type="text" name="username" id="username"/>
         <label for="password">Password:</label>
	 <input type="password" name="password" id="password"/>
	 <input type="submit" name="login" value="login"/>
      </form>
      {% endif %}
{% endblock %}

{% block onload %}
onload="init();"
{% endblock %}

{% block content %}
      {% if user.is_authenticated %}
      <input type="button" id="batchEdit" value="batch edit"/>
      {% endif %}
      <div class="pagination">
          <span class="step-links">
              {% if datasets.has_previous %}
              <a href="?page={{ datasets.previous_page_number }}">previous</a>
              {% endif %}

              <span class="current">Page {{ datasets.number }} of {{ datasets.paginator.num_pages }}.</span>

              {% if datasets.has_next %}
              <a href="?page={{ datasets.next_page_number }}">next</a>
              {% endif %}
          </span>
      </div>
      <table>
         <tr>{% if user.is_authenticated %}
	     <th><input type="checkbox" id="masterCheckbox"/></th>
	     {% endif %}
	     <th>ID</th>
	     <th>GSMID</th>
	     <th>Paper</th>
	     <th>Factor</th>
	     <th>Antibody</th>
	     <th>Platform</th>
	     <th>Species</th>
	     <th>Cell Type</th>
	     <th>Tissue Type</th>
	     <th>Cell Line</th>
	     <th>Cell Pop</th>
	     <th>Strain</th>
	     <th>Condition</th>
	     <th>Status</th>
	     <th>Comments</th>
	     <th>Curator</th>
	     <th>Date Collected</th>
	 </tr>
	 {% for d in datasets.object_list %}
	 <tr>
	     {% if user.is_authenticated %}
	     <td><input type="checkbox" class="rowSelect" id="{{d.id}}"/></td>
	     {% endif %}
	     <td><a href="{% url dataset_profile d.id %}">{{d.id}}</a></td>
	     <td><a href="{% url dataset_profile d.id %}">{{d.gsmid}}</a></td>
	     <td>
	      <a href="{% url datasets %}?paper={{d.paper.id}}">{{d.paper.pmid}}</a></br></br>
	      <a href="{% url paper_profile d.paper.id %}">paper profile</a>
	     </td>
	     <td><a href="{% url datasets %}?factor={{d.factor.id}}">{{d.factor.name}}</a></td>
	     <td><a href="{% url datasets %}?antibody={{d.factor.id}}">{{d.factor.antibody}}</a></td>
	     <td><a href="{%url datasets %}?platform={{d.platform.id}}">{{d.platform.name}}</a></td>
	     <td><a href="{% url datasets %}?species={{d.species.id}}">{{d.species}}</a></td>
	     <td><a href="{% url datasets %}?celltype={{d.cell_type.id}}">{{d.cell_type.name}}</a></td>
	     <td><a href="{% url datasets %}?tissuetype={{d.cell_type.id}}">{{d.cell_type.tissue_type}}</a></td>
	     <td><a href="{% url datasets %}?cellline={{d.cell_line.id}}">{{d.cell_line.name}}</a></td>
	     <td><a href="{% url datasets %}?cellpop={{d.cell_pop.id}}">{{d.cell_pop.name}}</a></td>
	     <td><a href="{% url datasets %}?strain={{d.strain.id}}">{{d.strain.name}}</a></td>
	     <td><a href="{% url datasets %}?condition={{d.condition.id}}">{{d.condition.name}}</a></td>
	     {% ifequal d.status "imported" %}
	     <td class="imported_row">{{ d.get_status_display }}</td>
	     {% else %} {% ifequal d.status "downloaded" %}
	     <td class="downloaded_row">{{ d.get_status_display }}</td>
	     {% else %} {% ifequal d.status "error" %}
	     <td class="error_row">{{ d.get_status_display }}</td>
	     {% else %}
	     <td>{{ d.get_status_display }}</td>
	     {% endifequal %}{% endifequal %}{% endifequal %}
	     <td>{{ d.comments }}</td>
	     <td><a href="{% url datasets %}{{d.user.id}}/">{{ d.user }}</a></td>
	     <td>{{ d.date_collected|date:"Y-m-d"}}</td>
	 </tr>
	 {% endfor %}
      </table>
<!-- from http://docs.djangoproject.com/en/1.1/topics/pagination/-->
      <div class="pagination">
          <span class="step-links">
              {% if datasets.has_previous %}
              <a href="?page={{ datasets.previous_page_number }}">previous</a>
              {% endif %}

              <span class="current">Page {{ datasets.number }} of {{ datasets.paginator.num_pages }}.</span>

              {% if datasets.has_next %}
              <a href="?page={{ datasets.next_page_number }}">next</a>
              {% endif %}
          </span>
      </div>
{% endblock %}

